<?xml version="1.0" encoding="utf-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title></title>
  <link href="../Styles/javaee-darb.css" rel="stylesheet" type="text/css" />
</head>

<body>
  <div class="ind">
    <a id="GJJWX"></a><a id="JEETT00105"></a>

    <h1 class="chapter"><span class="secnum">50</span> Java EE Security: Advanced Topics</h1>

    <p>This chapter provides advanced information on securing Java EE applications.</p>

    <p>The following topics are addressed here:</p>

    <ul>
      <li>
        <p><a href="../Text/security-advanced.xhtml#BNBYB">Working with Digital Certificates</a></p>
      </li>

      <li>
        <p><a href="../Text/security-advanced.xhtml#GLIEN">Authentication Mechanisms</a></p>
      </li>

      <li>
        <p><a href="../Text/security-advanced.xhtml#BABEJJDE">Using the JDBC Realm for User Authentication</a></p>
      </li>

      <li>
        <p><a href="../Text/security-advanced.xhtml#BABGEJJJ">Securing HTTP Resources</a></p>
      </li>

      <li>
        <p><a href="../Text/security-advanced.xhtml#GLIGC">Securing Application Clients</a></p>
      </li>

      <li>
        <p><a href="../Text/security-advanced.xhtml#GLIFD">Securing Enterprise Information Systems Applications</a></p>
      </li>

      <li>
        <p><a href="../Text/security-advanced.xhtml#GKHRL">Configuring Security Using Deployment Descriptors</a></p>
      </li>

      <li>
        <p><a href="../Text/security-advanced.xhtml#BABBGBBF">Further Information about Advanced Security Topics</a></p>
      </li>
    </ul>
  </div>

  <div class="ind">
    <a id="BNBYB"></a><a id="JEETT00522"></a>

    <div class="sect1">
      <h1 class="sect1" id="sigil_toc_id_799"><span class="secnum">50.1</span> <a id="sthref2731"></a><a id="sthref2732"></a><a id="sthref2733"></a><a id="sthref2734"></a>Working with Digital Certificates</h1>

      <p>Digital certificates for GlassFish Server have already been generated and can be found in the directory <span class="variable">domain-dir</span><code>/config/</code>. These digital certificates are self-signed and are intended for use in a development environment; they are not intended for production purposes. For production purposes, generate your own certificates and have them signed by a Certificate Authority (CA).</p>

      <p>To use the Secure Sockets Layer (SSL), an application or web server must have an associated certificate for each external interface, or IP address, that accepts secure connections. The theory behind this design is that a server should provide some kind of reasonable assurance that its owner is who you think it is, particularly before receiving any sensitive information. It may be useful to think of a certificate as a "digital driver's license" for an Internet address. The certificate states with which company the site is associated, along with some basic contact information about the site owner or administrator.</p>

      <p><a id="sthref2735"></a>The digital certificate is cryptographically signed by its owner and is difficult for anyone else to forge. For sites involved in e-commerce or in any other business transaction in which authentication of identity is important, a certificate can be purchased from a well-known CA such as VeriSign or Thawte. If your server certificate is self-signed, you must install it in the GlassFish Server keystore file (<code>keystore.jks</code>). If your client certificate is self-signed, you should install it in the GlassFish Server truststore file (<code>cacerts.jks</code>).</p>

      <p>Sometimes, authentication is not really a concern. For example, an administrator might simply want to ensure that data being transmitted and received by the server is private and cannot be snooped by anyone eavesdropping on the connection. In such cases, you can save the time and expense involved in obtaining a CA certificate and simply use a self-signed certificate.</p>

      <p><a id="sthref2736"></a><a id="sthref2737"></a><a id="sthref2738"></a><a id="sthref2739"></a>SSL uses <span class="glossaryterm">public-key cryptography</span>, which is based on key pairs. <span class="glossaryterm">Key pairs</span> contain one public key and one private key. Data encrypted with one key can be decrypted only with the other key of the pair. This property is fundamental to establishing trust and privacy in transactions. For example, using SSL, the server computes a value and encrypts it by using its private key. The encrypted value is called a <span class="glossaryterm">digital signature</span>. The client decrypts the encrypted value by using the server's public key and compares the value to its own computed value. If the two values match, the client can trust that the signature is authentic, because only the private key could have been used to produce such a signature.</p>

      <p><a id="sthref2740"></a>Digital certificates are used with HTTPS to authenticate web clients. The HTTPS service of most web servers will not run unless a digital certificate has been installed. Use the procedure outlined in the next section, <a href="../Text/security-advanced.xhtml#BNBYC">Creating a Server Certificate</a>, to set up a digital certificate that can be used by your application or web server to enable SSL.</p>

      <p><a id="sthref2741"></a><a id="sthref2742"></a><a id="sthref2743"></a><a id="sthref2744"></a>One tool that can be used to set up a digital certificate is <code>keytool</code>, a key and certificate management utility that ships with the JDK. This tool enables users to administer their own public/private key pairs and associated certificates for use in self-authentication, whereby the user authenticates himself or herself to other users or services, or data integrity and authentication services, using digital signatures. The tool also allows users to cache the public keys, in the form of certificates, of their communicating peers.</p>

      <p>For a better understanding of <code>keytool</code> and public-key cryptography, see <a href="../Text/security-advanced.xhtml#BABBGBBF">Further Information about Advanced Security Topics</a> for a link to the <code>keytool</code> documentation.</p><a id="BNBYC"></a><a id="JEETT01241"></a>

      <div class="sect2">
        <h2 class="sect2" id="sigil_toc_id_800"><span class="secnum">50.1.1</span> <a id="sthref2745"></a>Creating a Server Certificate</h2>

        <p>A server certificate has already been created for GlassFish Server and can be found in the <span class="variable">domain-dir</span><code>/config/</code> directory. The server certificate is in <code>keystore.jks</code>. The <code>cacerts.jks</code> file contains all the trusted certificates, including client certificates.</p>

        <p><a id="sthref2746"></a>If necessary, you can use <code>keytool</code> to generate certificates. The <code>keytool</code> utility stores the keys and certificates in a file termed a <span class="glossaryterm">keystore</span>, a repository of certificates used for identifying a client or a server. Typically, a keystore is a file that contains one client's or one server's identity. The keystore protects private keys by using a password.</p>

        <p>If you don't specify a directory when specifying the keystore file name, the keystores are created in the directory from which the <code>keytool</code> command is run. This can be the directory where the application resides, or it can be a directory common to many applications.</p>

        <p>The general steps for creating a server certificate are as follows.</p>

        <ol>
          <li>
            <p>Create the keystore.</p>
          </li>

          <li>
            <p>Export the certificate from the keystore.</p>
          </li>

          <li>
            <p>Sign the certificate.</p>
          </li>

          <li>
            <p><a id="sthref2747"></a>Import the certificate into a <span class="glossaryterm">truststore</span>: a repository of certificates used for verifying the certificates. A truststore typically contains more than one certificate.</p>
          </li>
        </ol>

        <p>The next section provides specific information on using the <code>keytool</code> utility to perform these steps.</p><a id="GJRGY"></a><a id="JEETT00254"></a>

        <div class="sect3">
          <h3 class="sect3 sigil_not_in_toc"><span class="secnum">50.1.1.1</span> To Use keytool to Create a Server Certificate</h3>

          <p>Run <code>keytool</code> to generate a new key pair in the default development keystore file, <code>keystore.jks</code>. This example uses the alias <code>server-alias</code> to generate a new public/private key pair and wrap the public key into a self-signed certificate inside <code>keystore.jks</code>. The key pair is generated by using an algorithm of type RSA, with a default password of <code>changeit</code>. For more information and other examples of creating and managing keystore files, read the <code>keytool</code> documentation.</p>

          <div align="center">
            <div class="inftblnote">
              <br />

              <table border="1" cellpadding="3" cellspacing="0" class="Note oac_no_warn" frame="hsides" rules="groups" summary="" width="80%">
                <tbody>
                  <tr>
                    <td align="left">
                      <p class="notep1">Note:</p>

                      <p>RSA is public-key encryption technology developed by RSA Data Security, Inc.</p>
                    </td>
                  </tr>
                </tbody>
              </table><br />
            </div>
          </div>

          <p>From the directory in which you want to create the key pair, run <code>keytool</code> as shown in the following steps.</p>

          <ol>
            <li>
              <p>Generate the server certificate.</p>

              <p>Enter the <code>keytool</code> command all on one line:</p>
              <pre class="oac_no_warn" xml:space="preserve">
<span class="variable">java-home</span>/bin/keytool -genkey -alias server-alias -keyalg RSA 
-keypass changeit -storepass changeit -keystore keystore.jks
</pre>

              <p>When you press <span class="gui-object-action">Enter</span>, <code>keytool</code> prompts you to enter the server name, organizational unit, organization, locality, state, and country code.</p>

              <p>You must enter the server name in response to <code>keytool</code>'s first prompt, in which it asks for first and last names. For testing purposes, this can be <code>localhost</code>.</p>
            </li>

            <li>
              <p>Export the generated server certificate in <code>keystore.jks</code> into the file <code>server.cer</code>.</p>

              <p>Enter the <code>keytool</code> command all on one line:</p>
              <pre class="oac_no_warn" xml:space="preserve">
<span class="variable">java-home</span>/bin/keytool -export -alias server-alias -storepass changeit 
-file server.cer -keystore keystore.jks
</pre>
            </li>

            <li>
              <p>If you want to have the certificate signed by a CA, read the example in the <code>keytool</code> documentation.</p>
            </li>

            <li>
              <p>To add the server certificate to the truststore file, <code>cacerts.jks</code>, run <code>keytool</code> from the directory where you created the keystore and server certificate.</p>

              <p>Use the following parameters:</p>
              <pre class="oac_no_warn" xml:space="preserve">
<span class="variable">java-home</span>/bin/keytool -import -v -trustcacerts -alias server-alias 
-file server.cer -keystore cacerts.jks -keypass changeit 
-storepass changeit 
</pre>

              <p>Information on the certificate, such as that shown next, will appear:</p>
              <pre class="oac_no_warn" xml:space="preserve">
Owner: CN=localhost, OU=My Company, O=Software, L=Santa Clara, ST=CA, C=US
Issuer: CN=localhost, OU=My Company, O=Software, L=Santa Clara, ST=CA, C=US
Serial number: 3e932169 
Valid from: Mon Nov 26 18:15:47 EST 2012 until: Sun Feb 24 18:15:47 EST 2013
Certificate fingerprints:
         MD5: 52:9F:49:68:ED:78:6F:39:87:F3:98:B3:6A:6B:0F:90
         SHA1: EE:2E:2A:A6:9E:03:9A:3A:1C:17:4A:28:5E:97:20:78:3F:
         SHA256: 80:05:EC:7E:50:50:5D:AA:A3:53:F1:11:9B:19:EB:0D:20:67:C1:12:
AF:42:EC:CD:66:8C:BD:99:AD:D9:76:95
         Signature algorithm name: SHA256withRSA         Version: 3
         ...
Trust this certificate? [no]:
</pre>
            </li>

            <li>
              <p>Enter <code>yes</code>, then press the <span class="gui-object-action">Enter</span> or <span class="gui-object-action">Return</span> key.</p>

              <p>The following information appears:</p>
              <pre class="oac_no_warn" xml:space="preserve">
Certificate was added to keystore
[Storing cacerts.jks]
</pre>
            </li>
          </ol>
        </div>
      </div><a id="GLIFW"></a><a id="JEETT01242"></a>

      <div class="sect2">
        <h2 class="sect2" id="sigil_toc_id_801"><span class="secnum">50.1.2</span> Adding Users to the Certificate Realm</h2>

        <p><a id="sthref2748"></a><a id="sthref2749"></a>In the <code>certificate</code> realm, user identity is set up in the GlassFish Server security context and populated with user data obtained from cryptographically verified client certificates. For step-by-step instructions for creating this type of certificate, see <a href="../Text/security-advanced.xhtml#BNBYB">Working with Digital Certificates</a>.</p>
      </div><a id="BNBYF"></a><a id="JEETT01243"></a>

      <div class="sect2">
        <h2 class="sect2" id="sigil_toc_id_802"><span class="secnum">50.1.3</span> <a id="sthref2750"></a>Using a Different Server Certificate with GlassFish Server</h2>

        <p>Follow the steps in <a href="../Text/security-advanced.xhtml#BNBYC">Creating a Server Certificate</a> to create your own server certificate, have it signed by a CA, and import the certificate into <code>keystore.jks</code>.</p>

        <p>Make sure that when you create the certificate, you follow these rules.</p>

        <ul>
          <li>
            <p>When you create the server certificate, <code>keytool</code> prompts you to enter your first and last name. In response to this prompt, you must enter the name of your server. For testing purposes, this can be <code>localhost</code>.</p>
          </li>

          <li>
            <p>If you want to replace the existing <code>keystore.jks</code>, you must either change your keystore's password to the default password (<code>changeit</code>) or change the default password to your keystore's password.</p>
          </li>
        </ul>

        <div class="sect3">
          <a id="sthref2751"></a>

          <h3 class="sect3 sigil_not_in_toc"><span class="secnum">50.1.3.1</span> To Specify a Different Server Certificate</h3>

          <p>To specify that GlassFish Server should use the new keystore for authentication and authorization decisions, you must set the JVM options for GlassFish Server so that they recognize the new keystore. To use a different keystore from the one provided for development purposes, follow these steps.</p>

          <ol>
            <li>
              <p>Start GlassFish Server if you haven't already done so. Information on starting the GlassFish Server can be found in <a href="../Text/usingexamples.xhtml#BNADI">Starting and Stopping GlassFish Server</a>.</p>
            </li>

            <li>
              <p>Open the GlassFish Server Administration Console in a web browser at <code>http://localhost:4848</code>.</p>
            </li>

            <li>
              <p>Expand <span class="gui-object-action">Configurations</span>, then expand <span class="gui-object-action">server-config</span>, then click <span class="gui-object-action">JVM Settings</span>.</p>
            </li>

            <li>
              <p>Click the <span class="gui-object-action">JVM Options</span> tab.</p>
            </li>

            <li>
              <p>Change the following JVM options so that they point to the location and name of the new keystore. The current settings are shown below:</p>
              <pre class="oac_no_warn" xml:space="preserve">
-Djavax.net.ssl.keyStore=${com.sun.aas.instanceRoot}/config/keystore.jks
-Djavax.net.ssl.trustStore=${com.sun.aas.instanceRoot}/config/cacerts.jks
</pre>
            </li>

            <li>
              <p>If you've changed the keystore password from its default value, you need to add the password option as well:</p>
              <pre class="oac_no_warn" xml:space="preserve">
-Djavax.net.ssl.keyStorePassword=<span class="variable">your-new-password </span>
</pre>
            </li>

            <li>
              <p>Click <span class="gui-object-action">Save</span>, then restart GlassFish Server.</p>
            </li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <div class="ind">
    <a id="GLIEN"></a><a id="JEETT00523"></a>

    <div class="sect1">
      <h1 class="sect1" id="sigil_toc_id_803"><span class="secnum">50.2</span> Authentication Mechanisms</h1>

      <p>This section discusses the client authentication and mutual authentication mechanisms.</p><a id="GLIEQ"></a><a id="JEETT01244"></a>

      <div class="sect2">
        <h2 class="sect2" id="sigil_toc_id_804"><span class="secnum">50.2.1</span> <a id="sthref2752"></a><a id="sthref2753"></a><a id="sthref2754"></a><a id="sthref2755"></a><a id="sthref2756"></a><a id="sthref2757"></a><a id="sthref2758"></a><a id="sthref2759"></a><a id="sthref2760"></a>Client Authentication</h2>

        <p>With <span class="glossaryterm">client authentication</span>, the web server authenticates the client by using the client's public key certificate. Client authentication is a more secure method of authentication than either basic or form-based authentication. It uses HTTP over SSL (HTTPS), in which the server authenticates the client using the client's public key certificate. SSL technology provides data encryption, server authentication, message integrity, and optional client authentication for a TCP/IP connection. You can think of a public key certificate as the digital equivalent of a passport. The certificate is issued by a trusted organization, a certificate authority (CA), and provides identification for the bearer.</p>

        <p>Before using client authentication, make sure that the client has a valid public key certificate. For more information on creating and using public key certificates, read <a href="../Text/security-advanced.xhtml#BNBYB">Working with Digital Certificates</a>.</p>

        <p>The following example shows how to declare client authentication in your deployment descriptor:</p>
        <pre class="oac_no_warn" xml:space="preserve">
&lt;login-config&gt;
    &lt;auth-method&gt;CLIENT-CERT&lt;/auth-method&gt;
&lt;/login-config&gt;
</pre>
      </div><a id="GLIEL"></a><a id="JEETT01245"></a>

      <div class="sect2">
        <h2 class="sect2" id="sigil_toc_id_805"><span class="secnum">50.2.2</span> <a id="sthref2761"></a><a id="sthref2762"></a>Mutual Authentication</h2>

        <p>With <span class="glossaryterm">mutual authentication</span>, the server and the client authenticate each other. Mutual authentication is of two types:</p>

        <ul>
          <li>
            <p>Certificate-based (see <a href="../Text/security-advanced.xhtml#GLIFJ">Figure 50-1</a>)</p>
          </li>

          <li>
            <p>User name/password-based (see <a href="../Text/security-advanced.xhtml#GLIGQ">Figure 50-2</a>)</p>
          </li>
        </ul>

        <p><a id="sthref2763"></a>When using certificate-based mutual authentication, the following actions occur.</p>

        <ol>
          <li>
            <p>A client requests access to a protected resource.</p>
          </li>

          <li>
            <p>The web server presents its certificate to the client.</p>
          </li>

          <li>
            <p>The client verifies the server's certificate.</p>
          </li>

          <li>
            <p>If successful, the client sends its certificate to the server.</p>
          </li>

          <li>
            <p>The server verifies the client's credentials.</p>
          </li>

          <li>
            <p>If successful, the server grants access to the protected resource requested by the client.</p>
          </li>
        </ol>

        <p><a href="../Text/security-advanced.xhtml#GLIFJ">Figure 50-1</a> shows what occurs during certificate-based mutual authentication.</p>

        <div class="figure">
          <a id="GLIFJ"></a><a id="JEETT00040"></a>

          <p class="titleinfigure">Figure 50-1 Certificate-Based Mutual Authentication</p><br />
          <a href="../Text/img_text/jeett_dt_.xhtml#img_text/jeett_dt_048.htm" id="sthref2764">Description of "Figure 50-1 Certificate-Based Mutual Authentication"</a><br />
          <br />
        </div>

        <p><a id="sthref2765"></a>In user name/password-based mutual authentication, the following actions occur.</p>

        <ol>
          <li>
            <p>A client requests access to a protected resource.</p>
          </li>

          <li>
            <p>The web server presents its certificate to the client.</p>
          </li>

          <li>
            <p>The client verifies the server's certificate.</p>
          </li>

          <li>
            <p>If successful, the client sends its user name and password to the server.</p>
          </li>

          <li>
            <p>The server verifies the client's credentials</p>
          </li>

          <li>
            <p>If the verification is successful, the server grants access to the protected resource requested by the client.</p>
          </li>
        </ol>

        <p><a href="../Text/security-advanced.xhtml#GLIGQ">Figure 50-2</a> shows what occurs during user name/password-based mutual authentication.</p>

        <div class="figure">
          <a id="GLIGQ"></a><a id="JEETT00041"></a>

          <p class="titleinfigure">Figure 50-2 User Name/Password-Based Mutual Authentication</p><br />
          <a href="../Text/img_text/jeett_dt_.xhtml#img_text/jeett_dt_049.htm" id="sthref2766">Description of "Figure 50-2 User Name/Password-Based Mutual Authentication"</a><br />
          <br />
        </div><a id="BNBYH"></a><a id="JEETT00791"></a>

        <div class="sect3">
          <h3 class="sect3 sigil_not_in_toc"><span class="secnum">50.2.2.1</span> <a id="sthref2767"></a><a id="sthref2768"></a><a id="sthref2769"></a><a id="sthref2770"></a>Enabling Mutual Authentication over SSL</h3>

          <p>This section discusses setting up client-side authentication. Enabling both server-side and client-side authentication is called mutual, or two-way, authentication. In client authentication, clients are required to submit certificates issued by a certificate authority that you choose to accept.</p>

          <p>There are at least two ways to enable mutual authentication over SSL.</p>

          <ul>
            <li>
              <p>The preferred method is to set the method of authentication in the <code>web.xml</code> application deployment descriptor to <code>CLIENT-CERT</code>. This enforces mutual authentication by modifying the deployment descriptor of the given application. In this way, client authentication is enabled only for a specific resource controlled by the security constraint, and the check is performed only when the application requires client authentication.</p>
            </li>

            <li>
              <p>A less commonly used method is to set the <code>clientAuth</code> property in the <code>certificate</code> realm to <code>true</code> if you want the SSL stack to require a valid certificate chain from the client before accepting a connection. A <code>false</code> value (which is the default) will not require a certificate chain unless the client requests a resource protected by a security constraint that uses <code>CLIENT-CERT</code> authentication. When you enable client authentication by setting the <code>clientAuth</code> property to <code>true</code>, client authentication will be required for all the requests going through the specified SSL port. If you turn <code>clientAuth</code> on, it is on all of the time, which can severely degrade performance.</p>
            </li>
          </ul>

          <p>When client authentication is enabled in both of these ways, client authentication will be performed twice.</p>
        </div><a id="BNBYI"></a><a id="JEETT00792"></a>

        <div class="sect3">
          <h3 class="sect3 sigil_not_in_toc"><span class="secnum">50.2.2.2</span> <a id="sthref2771"></a><a id="sthref2772"></a>Creating a Client Certificate for Mutual Authentication</h3>

          <p>If you have a certificate signed by a trusted Certificate Authority (CA) such as Verisign, and the GlassFish Server <code>cacerts.jks</code> file already contains a certificate verified by that CA, you do not need to complete this step. You need to install your certificate in the GlassFish Server certificate file only when your certificate is self-signed.</p>

          <p>From the directory where you want to create the client certificate, run <code>keytool</code> as outlined here. When you press Enter, <code>keytool</code> prompts you to enter the server name, organizational unit, organization, locality, state, and country code.</p>

          <p>You must enter the server name in response to <code>keytool</code>'s first prompt, in which it asks for first and last names. For testing purposes, this can be <code>localhost</code>. If this example is to verify mutual authentication and you receive a runtime error stating that the HTTPS host name is wrong, re-create the client certificate, being sure to use the same host name you will use when running the example. For example, if your machine name is <code>duke</code>, then enter <code>duke</code> as the certificate CN or when prompted for first and last names. When accessing the application, enter a URL that points to the same location (for example, <code>https://duke:8181/mutualauth/hello</code>). This is necessary because during SSL handshake, the server verifies the client certificate by comparing the certificate name to the host name from which it originates.</p>

          <p>To create a keystore named <code>client_keystore.jks</code> that contains a client certificate named <code>client.cer</code>, follow these steps.</p>

          <ol>
            <li>
              <p>Create a backup copy of the server truststore file. To do this,</p>

              <ol>
                <li>
                  <p>Change to the directory containing the server's keystore and truststore files, <span class="variable">domain-dir</span><code>\config</code>.</p>
                </li>

                <li>
                  <p>Copy <code>cacerts.jks</code> to <code>cacerts.backup.jks</code>.</p>
                </li>

                <li>
                  <p>Copy <code>keystore.jks</code> to <code>keystore.backup.jks</code>.</p>

                  <p>Do not put client certificates in the <code>cacerts.jks</code> file. Any certificate you add to the <code>cacerts</code> file effectively can be a trusted root for any and all certificate chains. After you have completed development, delete the development version of the <code>cacerts</code> file and replace it with the original copy.</p>
                </li>
              </ol>
            </li>

            <li>
              <p>Generate the client certificate. Enter the following command from the directory where you want to generate the client certificate:</p>
              <pre class="oac_no_warn" xml:space="preserve">
<span class="variable">java-home</span>\bin\keytool -genkey -alias client-alias -keyalg RSA 
-keypass changeit -storepass changeit -keystore client_keystore.jks
</pre>
            </li>

            <li>
              <p>Export the generated client certificate into the file <code>client.cer</code>:</p>
              <pre class="oac_no_warn" xml:space="preserve">
<span class="variable">java-home</span>\bin\keytool -export -alias client-alias -storepass changeit 
-file client.cer -keystore client_keystore.jks
</pre>
            </li>

            <li>
              <p>Add the certificate to the truststore file <span class="variable">domain-dir</span><code>/config/cacerts.jks</code>. Run <code>keytool</code> from the directory where you created the keystore and client certificate. Use the following parameters:</p>
              <pre class="oac_no_warn" xml:space="preserve">
<span class="variable">java-home</span>\bin\keytool -import -v -trustcacerts -alias client-alias 
-file client.cer -keystore <span class="variable">domain-dir</span>/config/cacerts.jks 
-keypass changeit -storepass changeit
</pre>

              <p>The <code>keytool</code> utility returns a message like this one:</p>
              <pre class="oac_no_warn" xml:space="preserve">
Owner: CN=localhost, OU=My Company, O=Software, L=Santa Clara, ST=CA, C=US
Issuer: CN=localhost, OU=My Company, O=Software, L=Santa Clara, ST=CA, C=US
Serial number: 3e39e66a
Valid from: Tue Nov 27 12:22:47 EST 2012 until: Mon Feb 25 12:22:47 EST 2013
Certificate fingerprints:
    MD5: 5A:B0:4C:88:4E:F8:EF:E9:E5:8B:53:BD:D0:AA:8E:5A
    SHA1:90:00:36:5B:E0:A7:A2:BD:67:DB:EA:37:B9:61:3E:26:B3:89:46:32
    Signature algorithm name: SHA1withRSA
    Version: 3
Trust this certificate? [no]: yes
Certificate was added to keystore
[Storing cacerts.jks]
</pre>
            </li>

            <li>
              <p>Restart GlassFish Server.</p>
            </li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <div class="ind">
    <a id="BABEJJDE"></a>

    <div class="sect1">
      <h1 class="sect1" id="sigil_toc_id_806"><span class="secnum">50.3</span> Using the JDBC Realm for User Authentication</h1>

      <p>An authentication realm, sometimes called a <span class="italic">security policy domain</span> or <span class="italic">security domain</span>, is a scope over which an application server defines and enforces a common security policy. A realm contains a collection of users, who may or may not be assigned to a group. GlassFish Server comes preconfigured with the file, certificate, and administration realms. An administrator can also set up LDAP, JDBC, digest, or custom realms.</p>

      <p>An application can specify in its deployment descriptor which realm to use. If the application does not specify a realm, GlassFish Server uses its default realm, the <code>file</code> realm. If an application specifies that a JDBC realm is to be used for user authentication, GlassFish Server will retrieve user credentials from a database. The application server uses the database information and the enabled JDBC realm option in the configuration file.</p>

      <p>A database provides an easy way to add, edit, or delete users at runtime and enables users to create their own accounts without any administrative assistance. Using a database has an additional benefit: providing a place to securely store any extra user information. A realm can be thought of as a database of user names and passwords that identify valid users of a web application or set of web applications with an enumeration of the list of roles associated with each valid user. Access to specific web application resources is granted to all users in a particular role, instead of enumerating a list of associated users. A user name can have any number of roles associated with it.</p>

      <p>Two of the tutorial case studies, <a href="../Text/dukes-tutoring.xhtml#GKAEE">Chapter 58, "Duke's Tutoring Case Study Example,"</a> and <a href="../Text/dukes-forest.xhtml#GLNPW">Chapter 59, "Duke's Forest Case Study Example,"</a> use a JDBC realm for user authentication.</p>

      <div class="sect2">
        <a id="sthref2773"></a>

        <h2 class="sect2" id="sigil_toc_id_807"><span class="secnum">50.3.1</span> To Configure a JDBC Authentication Realm</h2>

        <p>GlassFish Server enables administrators to specify a user's credentials (user name and password) in the JDBC realm instead of in the connection pool. This prevents other applications from browsing the database tables for user credentials. By default, storing passwords as clear text is not supported in the JDBC realm. Under normal circumstances, passwords should not be stored as clear text.</p>

        <ol>
          <li>
            <p>Create the database tables in which user credentials for the realm will be stored.</p>
          </li>

          <li>
            <p>Add user credentials to the database tables you created.</p>
          </li>

          <li>
            <p>Create a JDBC connection pool for the database.</p>

            <p>You can use the Administration Console or the command line to create a connection pool.</p>
          </li>

          <li>
            <p>Create a JDBC resource for the database.</p>

            <p>You can use the Administration Console or the command line to create a JDBC resource.</p>
          </li>

          <li>
            <p>Create a realm.</p>

            <p>This step needs to associate the resource with the realm, define the tables and columns for users and groups used for authentication, and define the digest algorithm that will be used for storing passwords in the database.</p>

            <p>You can use the Administration Console or the command line to create a realm.</p>
          </li>

          <li>
            <p>Modify the deployment descriptor for your application to specify the JDBC realm.</p>

            <ul>
              <li>
                <p>For an enterprise application in an EAR file, modify the <code>glassfish-application.xml</code> file.</p>
              </li>

              <li>
                <p>For a web application in a WAR file, modify the <code>web.xml</code> file.</p>
              </li>

              <li>
                <p>For an enterprise bean in an EJB JAR file, modify the <code>glassfish-ejb-jar.xml</code> file.</p>
              </li>
            </ul>

            <p>For example, for a hypothetical application, the <code>web.xml</code> file could specify the <code>jdbcRealm</code> realm, as follows:</p>
            <pre class="oac_no_warn" xml:space="preserve">
&lt;login-config&gt;
    &lt;auth-method&gt;FORM&lt;/auth-method&gt;
   <code><span class="codeinlinebold"> &lt;realm-name&gt;jdbcRealm&lt;/realm-name&gt;</span></code>
    &lt;form-login-config&gt;
        &lt;form-login-page&gt;/login.xhtml&lt;/form-login-page&gt;
        &lt;form-error-page&gt;/login.xhtml&lt;/form-error-page&gt;
    &lt;/form-login-config&gt;
&lt;/login-config&gt;
&lt;security-constraint&gt;
    &lt;web-resource-collection&gt;
        &lt;web-resource-name&gt;Secure Pages&lt;/web-resource-name&gt;
        &lt;description/&gt;
        &lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
        &lt;role-name&gt;ADMINS&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;
</pre>

            <p>Form-based login is specified for all web pages under <code>/admin</code>. Access to those pages will be allowed only to users in the <code>ADMINS</code> role.</p>
          </li>

          <li>
            <p>Assign security roles to users or groups of users in the realm.</p>

            <p>To assign a security role to a group or to a user, add a security-role-mapping element to the application server-specific deployment descriptor, in this case <code>glassfish-web.xml</code>:</p>
            <pre class="oac_no_warn" xml:space="preserve">
&lt;security-role-mapping&gt;
    &lt;role-name&gt;USERS&lt;/role-name&gt;
    &lt;group-name&gt;USERS&lt;/group-name&gt;
&lt;/security-role-mapping&gt;
&lt;security-role-mapping&gt;
    &lt;role-name&gt;ADMINS&lt;/role-name&gt;
    &lt;group-name&gt;ADMINS&lt;/group-name&gt;
&lt;/security-role-mapping&gt;
</pre>

            <p>Since GlassFish Server users are assigned to groups during the user creation process, this is more efficient than mapping security roles to individual users.</p>
          </li>
        </ol>
      </div>
    </div>
  </div>

  <div class="ind">
    <a id="BABGEJJJ"></a>

    <div class="sect1">
      <h1 class="sect1" id="sigil_toc_id_808"><span class="secnum">50.4</span> Securing HTTP Resources</h1>

      <p>When a request URI is matched by multiple constrained URL patterns, the constraints that apply to the request are those that are associated with the best matching URL pattern. The servlet matching rules defined in Chapter 12, "Mapping Requests To Servlets," in the Java Servlet 3.1 Specification, are used to determine the best matching URL pattern to the request URI. No protection requirements apply to a request URI that is not matched by a constrained URL pattern. The HTTP method of the request plays no role in selecting the best matching URL pattern for a request.</p>

      <p>When HTTP methods are listed within a constraint definition, the protections defined by the constraint are applied to the listed methods only.</p>

      <p>When HTTP methods are not listed within a constraint definition, the protections defined by the constraint apply to the complete set of HTTP methods, including HTTP extension methods.</p>

      <p>When constraints with different protection requirements apply to the same combination of URL patterns and HTTP methods, the rules for combining the protection requirements are as defined in Section 13.8.1, "Combining Constraints," in the Java Servlet 3.1 Specification.</p>

      <p>Follow these guidelines to properly secure a web application.</p>

      <ul>
        <li>
          <p>Do not list HTTP methods within constraint definitions. This is the simplest way to ensure that you are not leaving HTTP methods unprotected. For example:</p>
          <pre class="oac_no_warn" xml:space="preserve">
<span class="bold">&lt;!-- SECURITY CONSTRAINT #1 --&gt;</span>
&lt;security-constraint&gt;
    &lt;display-name&gt;Do not enumerate Http Methods&lt;/display-name&gt;
    &lt;web-resource-collection&gt;
        &lt;url-pattern&gt;/company/*&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
        &lt;role-name&gt;sales&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;
</pre>

          <p>If you list methods in a constraint, all non-listed methods of the effectively infinite set of possible HTTP methods, including extension methods, will be <span class="italic">unprotected</span>. Use such a constraint <span class="italic">only</span> if you are certain that this is the protection scheme you intend to define. The following example shows a constraint that lists the GET method and thus defines no protection on any of the other possible HTTP methods:</p>
          <pre class="oac_no_warn" xml:space="preserve">
<span class="bold">&lt;!-- SECURITY CONSTRAINT #2 --&gt;</span>
&lt;security-constraint&gt;
    &lt;display-name&gt;
        Protect GET only, leave all other methods unprotected
    &lt;/display-name&gt;
    &lt;web-resource-collection&gt;
        &lt;url-pattern&gt;/company/*&lt;/url-pattern&gt;
        &lt;http-method&gt;GET&lt;/http-method&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
        &lt;role-name&gt;sales&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;
</pre>
        </li>

        <li>
          <p>If you need to apply specific types of protection to specific HTTP methods, make sure that you define constraints to cover every method that you want to permit, with or without constraint, at the corresponding URL patterns. If there are any methods that you do not want to permit, you must also create a constraint that denies access to those methods at the same patterns; for an example, see security constraint #5 in the next bullet.</p>

          <p>For example, to permit GET and POST, where POST requires authentication and GET is permitted without constraint, you could define the following constraints:</p>
          <pre class="oac_no_warn" xml:space="preserve">
<span class="bold">&lt;!-- SECURITY CONSTRAINT #3 --&gt;</span>
&lt;security-constraint&gt;
    &lt;display-name&gt;Allow unprotected GET&lt;/display-name&gt;
    &lt;web-resource-collection&gt;
        &lt;url-pattern&gt;/company/*&lt;/url-pattern&gt;
        &lt;http-method&gt;GET&lt;/http-method&gt;
    &lt;/web-resource-collection&gt;
&lt;/security-constraint&gt;

<span class="bold">&lt;!-- SECURITY CONSTRAINT #4 --&gt;</span>
&lt;security-constraint&gt;
    &lt;display-name&gt;Require authentication for POST&lt;/display-name&gt;
    &lt;web-resource-collection&gt;
        &lt;url-pattern&gt;/company/*&lt;/url-pattern&gt;
        &lt;http-method&gt;POST&lt;/http-method&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint&gt;
        &lt;role-name&gt;sales&lt;/role-name&gt;
    &lt;/auth-constraint&gt;
&lt;/security-constraint&gt;
</pre>
        </li>

        <li>
          <p>The simplest way to ensure that you deny all HTTP methods except those that you want to be permitted is to use <code>http-method-omission</code> elements to omit those HTTP methods from the security constraint, and also to define an <code>auth-constraint</code> that names no roles. The security constraint will apply to all methods except those that were named in the omissions, and the constraint will apply only to the resources matched by the patterns in the constraint.</p>

          <p>For example, the following constraint excludes access to all methods except GET and POST at the resources matched by the pattern <code>/company/*</code>:</p>
          <pre class="oac_no_warn" xml:space="preserve">
<span class="bold">&lt;!-- SECURITY CONSTRAINT #5 --&gt;</span>
&lt;security-constraint&gt;
    &lt;display-name&gt;Deny all HTTP methods except GET and POST&lt;/display-name&gt;
    &lt;web-resource-collection&gt;
        &lt;url-pattern&gt;/company/*&lt;/url-pattern&gt;
        &lt;http-method-omission&gt;GET&lt;/http-method-omission&gt;
        &lt;http-method-omission&gt;POST&lt;/http-method-omission&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint/&gt;
&lt;/security-constraint&gt;
</pre>

          <p>If you want to extend these exclusions to the unconstrained parts of your application, also include the URL pattern <code>/</code> (forward slash):</p>
          <pre class="oac_no_warn" xml:space="preserve">
<span class="bold">&lt;!-- SECURITY CONSTRAINT #6 --&gt;</span>
&lt;security-constraint&gt;
    &lt;display-name&gt;Deny all HTTP methods except GET and POST&lt;/display-name&gt;
    &lt;web-resource-collection&gt;
        &lt;url-pattern&gt;/company/*&lt;/url-pattern&gt;
        <span class="bold">&lt;url-pattern&gt;/&lt;/url-pattern&gt;</span>
        &lt;http-method-omission&gt;GET&lt;/http-method-omission&gt;
        &lt;http-method-omission&gt;POST&lt;/http-method-omission&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint/&gt;
&lt;/security-constraint&gt;
</pre>
        </li>

        <li>
          <p>If, for your web application, you do not want any resource to be accessible unless you explicitly define a constraint that permits access to it, you can define an <code>auth-constraint</code> that names no roles and associate it with the URL pattern <code>/</code>. The URL pattern <code>/</code> is the weakest matching pattern. Do not list any HTTP methods in this constraint:</p>
          <pre class="oac_no_warn" xml:space="preserve">
<span class="bold">&lt;!-- SECURITY CONSTRAINT #7 --&gt;</span>
&lt;security-constraint&gt;
    &lt;display-name&gt;
        Switch from Constraint to Permission model
        (where everything is denied by default)
    &lt;/display-name&gt;
    &lt;web-resource-collection&gt;
        &lt;url-pattern&gt;/&lt;/url-pattern&gt;
    &lt;/web-resource-collection&gt;
    &lt;auth-constraint/&gt;
&lt;/security-constraint&gt;
</pre>
        </li>
      </ul>
    </div>
  </div>

  <div class="ind">
    <a id="GLIGC"></a><a id="JEETT00524"></a>

    <div class="sect1">
      <h1 class="sect1" id="sigil_toc_id_809"><span class="secnum">50.5</span> <a id="sthref2774"></a><a id="sthref2775"></a><a id="sthref2776"></a>Securing Application Clients</h1>

      <p>The Java EE authentication requirements for application clients are the same as for other Java EE components, and the same authentication techniques can be used as for other Java EE application components. No authentication is necessary when accessing unprotected web resources.</p>

      <p>When accessing protected web resources, the usual varieties of authentication can be used: HTTP basic authentication, HTTP login-form authentication, or SSL client authentication. <a href="../Text/security-webtier.xhtml#BNCBN">Specifying an Authentication Mechanism in the Deployment Descriptor</a> describes how to specify HTTP basic authentication and HTTP login-form authentication. <a href="../Text/security-advanced.xhtml#GLIEQ">Client Authentication</a> describes how to specify SSL client authentication.</p>

      <p>Authentication is required when accessing protected enterprise beans. The authentication mechanisms for enterprise beans are discussed in <a href="../Text/security-javaee.xhtml#BNBYL">Securing Enterprise Beans</a>.</p>

      <p>An application client makes use of an authentication service provided by the application client container for authenticating its users. The container's service can be integrated with the native platform's authentication system so that a single sign-on capability is used. The container can authenticate the user either when the application is started or when a protected resource is accessed.</p>

      <p><a id="sthref2777"></a><a id="sthref2778"></a><a id="sthref2779"></a>An application client can provide a class, called a <span class="glossaryterm">login module</span>, to gather authentication data. If so, the <code>javax.security.auth.callback.CallbackHandler</code> interface must be implemented, and the class name must be specified in its deployment descriptor. The application's callback handler must fully support <code>Callback</code> objects specified in the <code>javax.security.auth.callback</code> package.</p><a id="GLIDW"></a><a id="JEETT01246"></a>

      <div class="sect2">
        <h2 class="sect2" id="sigil_toc_id_810"><span class="secnum">50.5.1</span> <a id="sthref2780"></a><a id="sthref2781"></a><a id="sthref2782"></a><a id="sthref2783"></a>Using Login Modules</h2>

        <p>An application client can use the Java Authentication and Authorization Service (JAAS) to create login modules for authentication. A JAAS-based application implements the <code>javax.security.auth.callback.CallbackHandler</code> interface so that it can interact with users to enter specific authentication data, such as user names or passwords, or to display error and warning messages.</p>

        <p>Applications implement the <code>CallbackHandler</code> interface and pass it to the login context, which forwards it directly to the underlying login modules. A login module uses the callback handler both to gather input, such as a password or smart card PIN, from users and to supply information, such as status information, to users. Because the application specifies the callback handler, an underlying login module can remain independent of the various ways applications interact with users.</p>

        <p>For example, the implementation of a callback handler for a GUI application might display a window to solicit user input, or the implementation of a callback handler for a command-line tool might simply prompt the user for input directly from the command line.</p>

        <p>The login module passes an array of appropriate callbacks to the callback handler's <code>handle</code> method, such as a <code>NameCallback</code> for the user name and a <code>PasswordCallback</code> for the password; the callback handler performs the requested user interaction and sets appropriate values in the callbacks. For example, to process a <code>NameCallback</code>, the <code>CallbackHandler</code> might prompt for a name, retrieve the value from the user, and call the <code>setName</code> method of the <code>NameCallback</code> to store the name.</p>

        <p><a id="sthref2784"></a><a id="sthref2785"></a>For more information on using JAAS for authentication in login modules, refer to the documentation listed in <a href="../Text/security-advanced.xhtml#BABBGBBF">Further Information about Advanced Security Topics</a>.</p>
      </div><a id="GLIHQ"></a><a id="JEETT01247"></a>

      <div class="sect2">
        <h2 class="sect2" id="sigil_toc_id_811"><span class="secnum">50.5.2</span> <a id="sthref2786"></a>Using Programmatic Login</h2>

        <p>Programmatic login enables the client code to supply user credentials. If you are using an EJB client, you can use the <code>com.sun.appserv.security.ProgrammaticLogin</code> class with its convenient <code>login</code> and <code>logout</code> methods. Programmatic login is specific to a server.</p>
      </div>
    </div>
  </div>

  <div class="ind">
    <a id="GLIFD"></a><a id="JEETT00525"></a>

    <div class="sect1">
      <h1 class="sect1" id="sigil_toc_id_812"><span class="secnum">50.6</span> <a id="sthref2787"></a><a id="sthref2788"></a>Securing Enterprise Information Systems Applications</h1>

      <p>In Enterprise Information Systems (EIS) applications, components request a connection to an EIS resource. As part of this connection, the EIS can require a sign-on for the requester to access the resource. The application component provider has two choices for the design of the EIS sign-on.</p>

      <ul>
        <li>
          <p><a id="sthref2789"></a><a id="sthref2790"></a><span class="bold">Container-managed sign-on</span>: The application component lets the container take the responsibility of configuring and managing the EIS sign-on. The container determines the user name and password for establishing a connection to an EIS instance. For more information, see <a href="../Text/security-advanced.xhtml#GLIHL">Container-Managed Sign-On</a>.</p>
        </li>

        <li>
          <p><a id="sthref2791"></a><a id="sthref2792"></a><span class="bold">Component-managed sign-on</span>: The application component code manages EIS sign-on by including code that performs the sign-on process to an EIS. For more information, see <a href="../Text/security-advanced.xhtml#GLIDP">Component-Managed Sign-On</a>.</p>
        </li>
      </ul>

      <p>You can also configure security for resource adapters. See <a href="../Text/security-advanced.xhtml#GLIGS">Configuring Resource Adapter Security</a>.</p><a id="GLIHL"></a><a id="JEETT01248"></a>

      <div class="sect2">
        <h2 class="sect2" id="sigil_toc_id_813"><span class="secnum">50.6.1</span> <a id="sthref2793"></a><a id="sthref2794"></a><a id="sthref2795"></a>Container-Managed Sign-On</h2>

        <p>In container-managed sign-on, an application component does not have to pass any sign-on security information to the <code>getConnection()</code> method. The security information is supplied by the container, as shown in the following example (the method call is highlighted in <span class="bold">bold</span>):</p>
        <pre class="oac_no_warn" xml:space="preserve">
// Business method in an application component
Context initctx = new InitialContext();
// Perform JNDI lookup to obtain a connection factory
javax.resource.cci.ConnectionFactory cxf =
    (javax.resource.cci.ConnectionFactory)initctx.lookup(
    "java:comp/env/eis/MainframeCxFactory");
// Invoke factory to obtain a connection. The security
// information is not passed in the getConnection method
javax.resource.cci.Connection cx = cxf.<span class="bold">getConnection()</span>;
...
</pre>
      </div><a id="GLIDP"></a><a id="JEETT01249"></a>

      <div class="sect2">
        <h2 class="sect2" id="sigil_toc_id_814"><span class="secnum">50.6.2</span> <a id="sthref2796"></a><a id="sthref2797"></a><a id="sthref2798"></a>Component-Managed Sign-On</h2>

        <p>In component-managed sign-on, an application component is responsible for passing the needed sign-on security information for the resource to the <code>getConnection</code> method. For example, security information might be a user name and password, as shown here (the method call is highlighted in <span class="bold">bold</span>):</p>
        <pre class="oac_no_warn" xml:space="preserve">
// Method in an application component
Context initctx = new InitialContext();

// Perform JNDI lookup to obtain a connection factory
javax.resource.cci.ConnectionFactory cxf =
    (javax.resource.cci.ConnectionFactory)initctx.lookup(
    "java:comp/env/eis/MainframeCxFactory");

// Get a new ConnectionSpec
com.myeis.ConnectionSpecImpl properties = //..

// Invoke factory to obtain a connection
properties.setUserName("...");
properties.setPassword("...");
javax.resource.cci.Connection cx =
    cxf.<span class="bold">getConnection(properties)</span>;
...
</pre>
      </div><a id="GLIGS"></a><a id="JEETT01250"></a>

      <div class="sect2">
        <h2 class="sect2" id="sigil_toc_id_815"><span class="secnum">50.6.3</span> <a id="sthref2799"></a><a id="sthref2800"></a>Configuring Resource Adapter Security</h2>

        <p>A resource adapter is a system-level software component that typically implements network connectivity to an external resource manager. A resource adapter can extend the functionality of the Java EE platform either by implementing one of the Java EE standard service APIs, such as a JDBC driver, or by defining and implementing a resource adapter for a connector to an external application system. Resource adapters can also provide services that are entirely local, perhaps interacting with native resources. Resource adapters interface with the Java EE platform through the Java EE service provider interfaces (Java EE SPI). A resource adapter that uses the Java EE SPIs to attach to the Java EE platform will be able to work with all Java EE products.</p>

        <p>To configure the security settings for a resource adapter, you need to edit the resource adapter descriptor file, <code>ra.xml</code>. Here is an example of the part of an <code>ra.xml</code> file that configures security properties for a resource adapter:</p>
        <pre class="oac_no_warn" xml:space="preserve">
&lt;authentication-mechanism&gt;
    &lt;authentication-mechanism-type&gt;
        BasicPassword
    &lt;/authentication-mechanism-type&gt;
    &lt;credential-interface&gt;
        javax.resource.spi.security.PasswordCredential
    &lt;/credential-interface&gt;
&lt;/authentication-mechanism&gt;
&lt;reauthentication-support&gt;false&lt;/reauthentication-support&gt;
</pre>

        <p>You can find out more about the options for configuring resource adapter security by reviewing <span class="variable">as-install</span><code>/lib/schemas/connector_1_7.xsd</code>. You can configure the following elements in the resource adapter deployment descriptor file.</p>

        <ul>
          <li>
            <p><span class="bold">Authentication mechanisms</span>: Use the <code>authentication-mechanism</code> element to specify an authentication mechanism supported by the resource adapter. This support is for the resource adapter, not for the underlying EIS instance.</p>

            <p>There are two supported mechanism types:</p>

            <ul>
              <li>
                <p><code>BasicPassword</code>, which supports the following interface:</p>
                <pre class="oac_no_warn" xml:space="preserve">
javax.resource.spi.security.PasswordCredential
</pre>
              </li>

              <li>
                <p><code>Kerbv5</code>, which supports the following interface:</p>
                <pre class="oac_no_warn" xml:space="preserve">
javax.resource.spi.security.GenericCredential
</pre>

                <p>GlassFish Server does not currently support this mechanism type.</p>
              </li>
            </ul>
          </li>

          <li>
            <p><span class="bold">Reauthentication support</span>: Use the <code>reauthentication-support</code> element to specify whether the resource adapter implementation supports reauthentication of existing <code>Managed-Connection</code> instances. Options are <code>true</code> or <code>false</code>.</p>
          </li>

          <li>
            <p><span class="bold">Security permissions</span>: Use the <code>security-permission</code> element to specify a security permission that is required by the resource adapter code. Support for security permissions is optional and is not supported in the current release of GlassFish Server. You can, however, manually update the <code>server.policy</code> file to add the relevant permissions for the resource adapter.</p>

            <p>The security permissions listed in the deployment descriptor are different from those required by the default permission set as specified in the connector specification.</p>

            <p>For more information on the implementation of the security permission specification, see the security policy file documentation listed in <a href="../Text/security-advanced.xhtml#BABBGBBF">Further Information about Advanced Security Topics</a>.</p>
          </li>
        </ul>

        <p>In addition to specifying resource adapter security in the <code>ra.xml</code> file, you can create a security map for a connector connection pool to map an application principal or a user group to a back-end EIS principal. The security map is usually used if one or more EIS back-end principals are used to execute operations (on the EIS) initiated by various principals or user groups in the application.</p>
      </div><a id="GLIGW"></a><a id="JEETT00255"></a>

      <div class="sect2">
        <h2 class="sect2" id="sigil_toc_id_816"><span class="secnum">50.6.4</span> Mapping an Application Principal to EIS Principals</h2>

        <p>When using GlassFish Server, you can use security maps to map the caller identity of the application (principal or user group) to a suitable EIS principal in container-managed transaction-based scenarios. When an application principal initiates a request to an EIS, GlassFish Server first checks for an exact principal by using the security map defined for the connector connection pool to determine the mapped back-end EIS principal. If there is no exact match, GlassFish Server uses the wildcard character specification, if any, to determine the mapped back-end EIS principal. Security maps are used when an application user needs to execute an EIS operation that requires execution as a specific identity in the EIS.</p>

        <p>To work with security maps, use the Administration Console. From the Administration Console, follow these steps to get to the security maps page.</p>

        <ol>
          <li>
            <p>In the navigation tree, expand the <span class="gui-object-action">Resources</span> node.</p>
          </li>

          <li>
            <p>Expand the <span class="gui-object-action">Connectors</span> node.</p>
          </li>

          <li>
            <p>Select the <span class="gui-object-action">Connector Connection Pools</span> node.</p>
          </li>

          <li>
            <p>On the <span class="gui-object-title">Connector Connection Pools</span> page, click the name of the connection pool for which you want to create a security map.</p>
          </li>

          <li>
            <p>Click the <span class="gui-object-action">Security Maps</span> tab.</p>
          </li>

          <li>
            <p>Click <span class="gui-object-action">New</span> to create a new security map for the connection pool.</p>
          </li>

          <li>
            <p>Enter a name by which you will refer to the security map, as well as the other required information.</p>

            <p>Click <span class="gui-object-action">Help</span> for more information on the individual options.</p>
          </li>
        </ol>
      </div>
    </div>
  </div>

  <div class="ind">
    <a id="GKHRL"></a><a id="JEETT00526"></a>

    <div class="sect1">
      <h1 class="sect1" id="sigil_toc_id_817"><span class="secnum">50.7</span> Configuring Security Using Deployment Descriptors</h1>

      <p>The recommended way to configure security in the Java EE 7 platform is with annotations. If you wish to override the security settings at deployment time, you can use security elements in the <code>web.xml</code> deployment descriptor to do so. This section describes how to use the deployment descriptor to specify basic authentication and to override default principal-to-role mapping.</p><a id="BNCCM"></a><a id="JEETT01251"></a>

      <div class="sect2">
        <h2 class="sect2" id="sigil_toc_id_818"><span class="secnum">50.7.1</span> Specifying Security for Basic Authentication in the Deployment Descriptor</h2>

        <p>The elements of the deployment descriptor that add basic authentication to an example tell the server or browser to perform the following tasks.</p>

        <ul>
          <li>
            <p>Send a standard login dialog box to collect user name and password data.</p>
          </li>

          <li>
            <p>Verify that the user is authorized to access the application.</p>
          </li>

          <li>
            <p>If authorized, display the servlet to the user.</p>
          </li>
        </ul>

        <p>The following sample code shows the security elements for a deployment descriptor that could be used in the example of basic authentication found in the <span class="variable">tut-install</span><code>/examples/security/hello2_basicauth/</code> directory:</p>
        <pre class="oac_no_warn" xml:space="preserve">
    &lt;security-constraint&gt;
        &lt;display-name&gt;SecurityConstraint&lt;/display-name&gt;
        &lt;web-resource-collection&gt;
             &lt;web-resource-name&gt;WRCollection&lt;/web-resource-name&gt;
            &lt;url-pattern&gt;/greeting&lt;/url-pattern&gt;
        &lt;/web-resource-collection&gt;
        &lt;auth-constraint&gt;
            &lt;role-name&gt;TutorialUser&lt;/role-name&gt;
        &lt;/auth-constraint&gt;
        &lt;user-data-constraint&gt;
             &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
        &lt;/user-data-constraint&gt;
    &lt;/security-constraint&gt;
    &lt;login-config&gt;
        &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
        &lt;realm-name&gt;file&lt;/realm-name&gt;
    &lt;/login-config&gt;
    &lt;security-role&gt;
        &lt;role-name&gt;TutorialUser&lt;/role-name&gt;
    &lt;/security-role&gt;
</pre>

        <p>This deployment descriptor specifies that the request URI <code>/greeting</code> can be accessed only by users who have entered their user names and passwords and have been authorized to access this URL because they have been verified to be in the role <code>TutorialUser</code>. The user name and password data will be sent over a protected transport in order to keep it from being read in transit.</p>
      </div><a id="GKAFQ"></a><a id="JEETT01252"></a>

      <div class="sect2">
        <h2 class="sect2" id="sigil_toc_id_819"><span class="secnum">50.7.2</span> Specifying Non-Default Principal-to-Role Mapping in the Deployment Descriptor</h2>

        <p>To map a role name permitted by the application or module to principals (users) and groups defined on the server, use the <code>security-role-mapping</code> element in the runtime deployment descriptor file (<code>glassfish-application.xml</code>, <code>glassfish-web.xml</code>, or <code>glassfish-ejb-jar.xml</code>). The entry needs to declare a mapping between a security role used in the application and one or more groups or principals defined for the applicable realm of GlassFish Server. An example for the <code>glassfish-web.xml</code> file is shown below:</p>
        <pre class="oac_no_warn" xml:space="preserve">
&lt;glassfish-web-app&gt;
    &lt;security-role-mapping&gt;
        &lt;role-name&gt;DIRECTOR&lt;/role-name&gt;
        &lt;principal-name&gt;schwartz&lt;/principal-name&gt;
    &lt;/security-role-mapping&gt;
    &lt;security-role-mapping&gt;
        &lt;role-name&gt;DEPT-ADMIN&lt;/role-name&gt;
        &lt;group-name&gt;dept-admins&lt;/group-name&gt;
    &lt;/security-role-mapping&gt;
&lt;/glassfish-web-app&gt;
</pre>

        <p>The role name can be mapped to either a specific principal (user), a group, or both. The principal or group names referenced must be valid principals or groups in the current default realm of GlassFish Server. The <code>role-name</code> in this example must exactly match the <code>role-name</code> in the <code>security-role</code> element of the corresponding <code>web.xml</code> file or the role name defined in the <code>@DeclareRoles</code> and/or <code>@RolesAllowed</code> annotations.</p>
      </div>
    </div>
  </div>

  <div class="ind">
    <a id="BABBGBBF"></a>

    <div class="sect1">
      <h1 class="sect1" id="sigil_toc_id_820"><span class="secnum">50.8</span> Further Information about Advanced Security Topics</h1>

      <p>For more information about the security topics covered in this chapter, see</p>

      <ul>
        <li>
          <p>Documentation on the <code>keytool</code> command:</p>

          <p><code><a href="../Text/http://docs.oracle.com/javase/7/docs/technotes/tools/solaris/keytool.xhtml#http://docs.oracle.com/javase/7/docs/technotes/tools/solaris/keytool.html">http://docs.oracle.com/javase/7/docs/technotes/tools/solaris/keytool.html</a></code></p>
        </li>

        <li>
          <p><span class="italic">Java Authentication and Authorization Service (JAAS) Reference Guide</span>:</p>

          <p><code><a href="../Text/http://docs.oracle.com/javase/7/docs/technotes/guides/security/jaas/JAASRefGuide.xhtml#http://docs.oracle.com/javase/7/docs/technotes/guides/security/jaas/JAASRefGuide.html">http://docs.oracle.com/javase/7/docs/technotes/guides/security/jaas/JAASRefGuide.html</a></code></p>
        </li>

        <li>
          <p><span class="italic">Java Authentication and Authorization Service (JAAS): LoginModule Developer's Guide</span>:</p>

          <p><code><a href="../Text/http://docs.oracle.com/javase/7/docs/technotes/guides/security/jaas/JAASLMDevGuide.xhtml#http://docs.oracle.com/javase/7/docs/technotes/guides/security/jaas/JAASLMDevGuide.html">http://docs.oracle.com/javase/7/docs/technotes/guides/security/jaas/JAASLMDevGuide.html</a></code></p>
        </li>

        <li>
          <p>Documentation on security policy file syntax:</p>

          <p><code><a href="../Text/http://docs.oracle.com/javase/7/docs/technotes/guides/security/PolicyFiles.xhtml#FileSyntax">http://docs.oracle.com/javase/7/docs/technotes/guides/security/PolicyFiles.html#FileSyntax</a></code></p>
        </li>
      </ul>
    </div>
  </div>
</body>
</html>
